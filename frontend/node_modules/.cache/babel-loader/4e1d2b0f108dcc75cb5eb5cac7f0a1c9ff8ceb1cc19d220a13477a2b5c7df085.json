{"ast":null,"code":"import React,{useState}from'react';import SiteLayout from'./layout/SiteLayout';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function Login(_ref){let{onLogin,onNavigateToRegister,onNavigateToHome}=_ref;const[username,setUsername]=useState('');const[password,setPassword]=useState('');const[otpCode,setOtpCode]=useState('');const[otpRequired,setOtpRequired]=useState(false);const[otpDeliveryMethod,setOtpDeliveryMethod]=useState('');const[error,setError]=useState('');const[isLoading,setIsLoading]=useState(false);const handleSubmit=async e=>{e.preventDefault();setError('');setIsLoading(true);try{if(!otpRequired){// Step 1: Submit username and password to get OTP\nif(!username||!password){throw new Error('Please enter both username and password');}const response=await fetch('http://localhost:5000/api/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,password,mfa_code:''})});const data=await response.json();if(!response.ok){throw new Error(data.error||'Login failed');}// Check if OTP is required\nif(data.otp_required){setOtpRequired(true);setOtpDeliveryMethod(data.otp_delivery_method);setError('');return;}// This shouldn't happen with the new OTP system, but handle it just in case\nthrow new Error('OTP generation failed');}else{// Step 2: Verify the 4-digit OTP\nif(!otpCode||otpCode.length!==4){throw new Error('Please enter a valid 4-digit code');}if(!otpCode.match(/^\\d{4}$/)){throw new Error('OTP must be exactly 4 digits');}const response=await fetch('http://localhost:5000/api/verify-login-otp',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,otp_code:otpCode})});const data=await response.json();if(!response.ok){throw new Error(data.error||'OTP verification failed');}// Check if password change is required\nif(data.require_password_change){alert('Your password has expired or is new. Please change it after logging in.');}onLogin(data.access_token,data.role);}}catch(err){setError(err.message);setIsLoading(false);}};return/*#__PURE__*/_jsx(SiteLayout,{onLoginClick:()=>{},onRegisterClick:onNavigateToRegister,isLoggedIn:false,children:/*#__PURE__*/_jsx(\"div\",{className:\"eci-content\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"eci-card\",children:[/*#__PURE__*/_jsx(\"h2\",{style:{marginTop:0},children:\"Login\"}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-danger\",children:error}),/*#__PURE__*/_jsx(\"form\",{onSubmit:handleSubmit,children:!otpRequired?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"username\",children:\"Username\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control\",id:\"username\",value:username,onChange:e=>setUsername(e.target.value),required:true,disabled:isLoading})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"password\",children:\"Password\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",className:\"form-control\",id:\"password\",value:password,onChange:e=>setPassword(e.target.value),required:true,disabled:isLoading})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn btn-primary\",disabled:isLoading,children:isLoading?'Logging in...':'Login'})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"alert alert-info\",children:[\"A 4-digit verification code has been sent to your \",otpDeliveryMethod,\". Please enter it below.\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"otpCode\",children:\"4-Digit OTP Code\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control\",id:\"otpCode\",value:otpCode,onChange:e=>{// Only allow digits\nconst value=e.target.value.replace(/\\D/g,'');setOtpCode(value);},placeholder:\"0000\",required:true,maxLength:\"4\",disabled:isLoading,inputMode:\"numeric\",autoComplete:\"off\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn btn-primary\",disabled:isLoading||otpCode.length!==4,children:isLoading?'Verifying...':'Verify OTP'}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-secondary\",onClick:()=>{setOtpRequired(false);setOtpCode('');setOtpDeliveryMethod('');},style:{marginLeft:'8px'},disabled:isLoading,children:\"Back to Login\"})]})}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:'16px'},children:/*#__PURE__*/_jsxs(\"p\",{children:[\"Don't have an account? \",/*#__PURE__*/_jsx(\"button\",{className:\"eci-link\",onClick:onNavigateToRegister,children:\"Register\"})]})})]})})});}export default Login;","map":{"version":3,"names":["React","useState","SiteLayout","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Login","_ref","onLogin","onNavigateToRegister","onNavigateToHome","username","setUsername","password","setPassword","otpCode","setOtpCode","otpRequired","setOtpRequired","otpDeliveryMethod","setOtpDeliveryMethod","error","setError","isLoading","setIsLoading","handleSubmit","e","preventDefault","Error","response","fetch","method","headers","body","JSON","stringify","mfa_code","data","json","ok","otp_required","otp_delivery_method","length","match","otp_code","require_password_change","alert","access_token","role","err","message","onLoginClick","onRegisterClick","isLoggedIn","children","className","style","marginTop","onSubmit","htmlFor","type","id","value","onChange","target","required","disabled","replace","placeholder","maxLength","inputMode","autoComplete","onClick","marginLeft"],"sources":["D:/Desktop folder/Major Project clg/frontend/src/components/Login.js"],"sourcesContent":["import React, { useState } from 'react';\nimport SiteLayout from './layout/SiteLayout';\n\nfunction Login({ onLogin, onNavigateToRegister, onNavigateToHome }) {\n  const [username, setUsername] = useState('');\n  const [password, setPassword] = useState('');\n  const [otpCode, setOtpCode] = useState('');\n  const [otpRequired, setOtpRequired] = useState(false);\n  const [otpDeliveryMethod, setOtpDeliveryMethod] = useState('');\n  const [error, setError] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setError('');\n    setIsLoading(true);\n    \n    try {\n      if (!otpRequired) {\n        // Step 1: Submit username and password to get OTP\n        if (!username || !password) {\n          throw new Error('Please enter both username and password');\n        }\n\n        const response = await fetch('http://localhost:5000/api/login', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({ \n            username, \n            password,\n            mfa_code: '' \n          }),\n        });\n        \n        const data = await response.json();\n        \n        if (!response.ok) {\n          throw new Error(data.error || 'Login failed');\n        }\n\n        // Check if OTP is required\n        if (data.otp_required) {\n          setOtpRequired(true);\n          setOtpDeliveryMethod(data.otp_delivery_method);\n          setError('');\n          return;\n        }\n\n        // This shouldn't happen with the new OTP system, but handle it just in case\n        throw new Error('OTP generation failed');\n\n      } else {\n        // Step 2: Verify the 4-digit OTP\n        if (!otpCode || otpCode.length !== 4) {\n          throw new Error('Please enter a valid 4-digit code');\n        }\n\n        if (!otpCode.match(/^\\d{4}$/)) {\n          throw new Error('OTP must be exactly 4 digits');\n        }\n\n        const response = await fetch('http://localhost:5000/api/verify-login-otp', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({ \n            username, \n            otp_code: otpCode\n          }),\n        });\n        \n        const data = await response.json();\n        \n        if (!response.ok) {\n          throw new Error(data.error || 'OTP verification failed');\n        }\n\n        // Check if password change is required\n        if (data.require_password_change) {\n          alert('Your password has expired or is new. Please change it after logging in.');\n        }\n\n        onLogin(data.access_token, data.role);\n      }\n    } catch (err) {\n      setError(err.message);\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <SiteLayout onLoginClick={() => {}} onRegisterClick={onNavigateToRegister} isLoggedIn={false}>\n      <div className=\"eci-content\">\n        <div className=\"eci-card\">\n          <h2 style={{ marginTop: 0 }}>Login</h2>\n          {error && <div className=\"alert alert-danger\">{error}</div>}\n          <form onSubmit={handleSubmit}>\n            {!otpRequired ? (\n              <>\n                <div className=\"form-group\">\n                  <label htmlFor=\"username\">Username</label>\n                  <input\n                    type=\"text\"\n                    className=\"form-control\"\n                    id=\"username\"\n                    value={username}\n                    onChange={(e) => setUsername(e.target.value)}\n                    required\n                    disabled={isLoading}\n                  />\n                </div>\n                <div className=\"form-group\">\n                  <label htmlFor=\"password\">Password</label>\n                  <input\n                    type=\"password\"\n                    className=\"form-control\"\n                    id=\"password\"\n                    value={password}\n                    onChange={(e) => setPassword(e.target.value)}\n                    required\n                    disabled={isLoading}\n                  />\n                </div>\n                <button \n                  type=\"submit\" \n                  className=\"btn btn-primary\"\n                  disabled={isLoading}\n                >\n                  {isLoading ? 'Logging in...' : 'Login'}\n                </button>\n              </>\n            ) : (\n              <>\n                <div className=\"alert alert-info\">\n                  A 4-digit verification code has been sent to your {otpDeliveryMethod}. Please enter it below.\n                </div>\n                <div className=\"form-group\">\n                  <label htmlFor=\"otpCode\">4-Digit OTP Code</label>\n                  <input\n                    type=\"text\"\n                    className=\"form-control\"\n                    id=\"otpCode\"\n                    value={otpCode}\n                    onChange={(e) => {\n                      // Only allow digits\n                      const value = e.target.value.replace(/\\D/g, '');\n                      setOtpCode(value);\n                    }}\n                    placeholder=\"0000\"\n                    required\n                    maxLength=\"4\"\n                    disabled={isLoading}\n                    inputMode=\"numeric\"\n                    autoComplete=\"off\"\n                  />\n                </div>\n                <button \n                  type=\"submit\" \n                  className=\"btn btn-primary\"\n                  disabled={isLoading || otpCode.length !== 4}\n                >\n                  {isLoading ? 'Verifying...' : 'Verify OTP'}\n                </button>\n                <button \n                  type=\"button\" \n                  className=\"btn btn-secondary\" \n                  onClick={() => {\n                    setOtpRequired(false);\n                    setOtpCode('');\n                    setOtpDeliveryMethod('');\n                  }}\n                  style={{ marginLeft: '8px' }}\n                  disabled={isLoading}\n                >\n                  Back to Login\n                </button>\n              </>\n            )}\n          </form>\n          <div style={{ marginTop: '16px' }}>\n            <p>Don't have an account? <button className=\"eci-link\" onClick={onNavigateToRegister}>Register</button></p>\n          </div>\n        </div>\n      </div>\n    </SiteLayout>\n  );\n}\n\nexport default Login;"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,KAAQ,OAAO,CACvC,MAAO,CAAAC,UAAU,KAAM,qBAAqB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,CAAAC,QAAA,IAAAC,SAAA,yBAE7C,QAAS,CAAAC,KAAKA,CAAAC,IAAA,CAAsD,IAArD,CAAEC,OAAO,CAAEC,oBAAoB,CAAEC,gBAAiB,CAAC,CAAAH,IAAA,CAChE,KAAM,CAACI,QAAQ,CAAEC,WAAW,CAAC,CAAGd,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAACe,QAAQ,CAAEC,WAAW,CAAC,CAAGhB,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAACiB,OAAO,CAAEC,UAAU,CAAC,CAAGlB,QAAQ,CAAC,EAAE,CAAC,CAC1C,KAAM,CAACmB,WAAW,CAAEC,cAAc,CAAC,CAAGpB,QAAQ,CAAC,KAAK,CAAC,CACrD,KAAM,CAACqB,iBAAiB,CAAEC,oBAAoB,CAAC,CAAGtB,QAAQ,CAAC,EAAE,CAAC,CAC9D,KAAM,CAACuB,KAAK,CAAEC,QAAQ,CAAC,CAAGxB,QAAQ,CAAC,EAAE,CAAC,CACtC,KAAM,CAACyB,SAAS,CAAEC,YAAY,CAAC,CAAG1B,QAAQ,CAAC,KAAK,CAAC,CAEjD,KAAM,CAAA2B,YAAY,CAAG,KAAO,CAAAC,CAAC,EAAK,CAChCA,CAAC,CAACC,cAAc,CAAC,CAAC,CAClBL,QAAQ,CAAC,EAAE,CAAC,CACZE,YAAY,CAAC,IAAI,CAAC,CAElB,GAAI,CACF,GAAI,CAACP,WAAW,CAAE,CAChB;AACA,GAAI,CAACN,QAAQ,EAAI,CAACE,QAAQ,CAAE,CAC1B,KAAM,IAAI,CAAAe,KAAK,CAAC,yCAAyC,CAAC,CAC5D,CAEA,KAAM,CAAAC,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAAC,iCAAiC,CAAE,CAC9DC,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CACP,cAAc,CAAE,kBAClB,CAAC,CACDC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CACnBxB,QAAQ,CACRE,QAAQ,CACRuB,QAAQ,CAAE,EACZ,CAAC,CACH,CAAC,CAAC,CAEF,KAAM,CAAAC,IAAI,CAAG,KAAM,CAAAR,QAAQ,CAACS,IAAI,CAAC,CAAC,CAElC,GAAI,CAACT,QAAQ,CAACU,EAAE,CAAE,CAChB,KAAM,IAAI,CAAAX,KAAK,CAACS,IAAI,CAAChB,KAAK,EAAI,cAAc,CAAC,CAC/C,CAEA;AACA,GAAIgB,IAAI,CAACG,YAAY,CAAE,CACrBtB,cAAc,CAAC,IAAI,CAAC,CACpBE,oBAAoB,CAACiB,IAAI,CAACI,mBAAmB,CAAC,CAC9CnB,QAAQ,CAAC,EAAE,CAAC,CACZ,OACF,CAEA;AACA,KAAM,IAAI,CAAAM,KAAK,CAAC,uBAAuB,CAAC,CAE1C,CAAC,IAAM,CACL;AACA,GAAI,CAACb,OAAO,EAAIA,OAAO,CAAC2B,MAAM,GAAK,CAAC,CAAE,CACpC,KAAM,IAAI,CAAAd,KAAK,CAAC,mCAAmC,CAAC,CACtD,CAEA,GAAI,CAACb,OAAO,CAAC4B,KAAK,CAAC,SAAS,CAAC,CAAE,CAC7B,KAAM,IAAI,CAAAf,KAAK,CAAC,8BAA8B,CAAC,CACjD,CAEA,KAAM,CAAAC,QAAQ,CAAG,KAAM,CAAAC,KAAK,CAAC,4CAA4C,CAAE,CACzEC,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CACP,cAAc,CAAE,kBAClB,CAAC,CACDC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CACnBxB,QAAQ,CACRiC,QAAQ,CAAE7B,OACZ,CAAC,CACH,CAAC,CAAC,CAEF,KAAM,CAAAsB,IAAI,CAAG,KAAM,CAAAR,QAAQ,CAACS,IAAI,CAAC,CAAC,CAElC,GAAI,CAACT,QAAQ,CAACU,EAAE,CAAE,CAChB,KAAM,IAAI,CAAAX,KAAK,CAACS,IAAI,CAAChB,KAAK,EAAI,yBAAyB,CAAC,CAC1D,CAEA;AACA,GAAIgB,IAAI,CAACQ,uBAAuB,CAAE,CAChCC,KAAK,CAAC,yEAAyE,CAAC,CAClF,CAEAtC,OAAO,CAAC6B,IAAI,CAACU,YAAY,CAAEV,IAAI,CAACW,IAAI,CAAC,CACvC,CACF,CAAE,MAAOC,GAAG,CAAE,CACZ3B,QAAQ,CAAC2B,GAAG,CAACC,OAAO,CAAC,CACrB1B,YAAY,CAAC,KAAK,CAAC,CACrB,CACF,CAAC,CAED,mBACEvB,IAAA,CAACF,UAAU,EAACoD,YAAY,CAAEA,CAAA,GAAM,CAAC,CAAE,CAACC,eAAe,CAAE3C,oBAAqB,CAAC4C,UAAU,CAAE,KAAM,CAAAC,QAAA,cAC3FrD,IAAA,QAAKsD,SAAS,CAAC,aAAa,CAAAD,QAAA,cAC1BnD,KAAA,QAAKoD,SAAS,CAAC,UAAU,CAAAD,QAAA,eACvBrD,IAAA,OAAIuD,KAAK,CAAE,CAAEC,SAAS,CAAE,CAAE,CAAE,CAAAH,QAAA,CAAC,OAAK,CAAI,CAAC,CACtCjC,KAAK,eAAIpB,IAAA,QAAKsD,SAAS,CAAC,oBAAoB,CAAAD,QAAA,CAAEjC,KAAK,CAAM,CAAC,cAC3DpB,IAAA,SAAMyD,QAAQ,CAAEjC,YAAa,CAAA6B,QAAA,CAC1B,CAACrC,WAAW,cACXd,KAAA,CAAAE,SAAA,EAAAiD,QAAA,eACEnD,KAAA,QAAKoD,SAAS,CAAC,YAAY,CAAAD,QAAA,eACzBrD,IAAA,UAAO0D,OAAO,CAAC,UAAU,CAAAL,QAAA,CAAC,UAAQ,CAAO,CAAC,cAC1CrD,IAAA,UACE2D,IAAI,CAAC,MAAM,CACXL,SAAS,CAAC,cAAc,CACxBM,EAAE,CAAC,UAAU,CACbC,KAAK,CAAEnD,QAAS,CAChBoD,QAAQ,CAAGrC,CAAC,EAAKd,WAAW,CAACc,CAAC,CAACsC,MAAM,CAACF,KAAK,CAAE,CAC7CG,QAAQ,MACRC,QAAQ,CAAE3C,SAAU,CACrB,CAAC,EACC,CAAC,cACNpB,KAAA,QAAKoD,SAAS,CAAC,YAAY,CAAAD,QAAA,eACzBrD,IAAA,UAAO0D,OAAO,CAAC,UAAU,CAAAL,QAAA,CAAC,UAAQ,CAAO,CAAC,cAC1CrD,IAAA,UACE2D,IAAI,CAAC,UAAU,CACfL,SAAS,CAAC,cAAc,CACxBM,EAAE,CAAC,UAAU,CACbC,KAAK,CAAEjD,QAAS,CAChBkD,QAAQ,CAAGrC,CAAC,EAAKZ,WAAW,CAACY,CAAC,CAACsC,MAAM,CAACF,KAAK,CAAE,CAC7CG,QAAQ,MACRC,QAAQ,CAAE3C,SAAU,CACrB,CAAC,EACC,CAAC,cACNtB,IAAA,WACE2D,IAAI,CAAC,QAAQ,CACbL,SAAS,CAAC,iBAAiB,CAC3BW,QAAQ,CAAE3C,SAAU,CAAA+B,QAAA,CAEnB/B,SAAS,CAAG,eAAe,CAAG,OAAO,CAChC,CAAC,EACT,CAAC,cAEHpB,KAAA,CAAAE,SAAA,EAAAiD,QAAA,eACEnD,KAAA,QAAKoD,SAAS,CAAC,kBAAkB,CAAAD,QAAA,EAAC,oDACkB,CAACnC,iBAAiB,CAAC,0BACvE,EAAK,CAAC,cACNhB,KAAA,QAAKoD,SAAS,CAAC,YAAY,CAAAD,QAAA,eACzBrD,IAAA,UAAO0D,OAAO,CAAC,SAAS,CAAAL,QAAA,CAAC,kBAAgB,CAAO,CAAC,cACjDrD,IAAA,UACE2D,IAAI,CAAC,MAAM,CACXL,SAAS,CAAC,cAAc,CACxBM,EAAE,CAAC,SAAS,CACZC,KAAK,CAAE/C,OAAQ,CACfgD,QAAQ,CAAGrC,CAAC,EAAK,CACf;AACA,KAAM,CAAAoC,KAAK,CAAGpC,CAAC,CAACsC,MAAM,CAACF,KAAK,CAACK,OAAO,CAAC,KAAK,CAAE,EAAE,CAAC,CAC/CnD,UAAU,CAAC8C,KAAK,CAAC,CACnB,CAAE,CACFM,WAAW,CAAC,MAAM,CAClBH,QAAQ,MACRI,SAAS,CAAC,GAAG,CACbH,QAAQ,CAAE3C,SAAU,CACpB+C,SAAS,CAAC,SAAS,CACnBC,YAAY,CAAC,KAAK,CACnB,CAAC,EACC,CAAC,cACNtE,IAAA,WACE2D,IAAI,CAAC,QAAQ,CACbL,SAAS,CAAC,iBAAiB,CAC3BW,QAAQ,CAAE3C,SAAS,EAAIR,OAAO,CAAC2B,MAAM,GAAK,CAAE,CAAAY,QAAA,CAE3C/B,SAAS,CAAG,cAAc,CAAG,YAAY,CACpC,CAAC,cACTtB,IAAA,WACE2D,IAAI,CAAC,QAAQ,CACbL,SAAS,CAAC,mBAAmB,CAC7BiB,OAAO,CAAEA,CAAA,GAAM,CACbtD,cAAc,CAAC,KAAK,CAAC,CACrBF,UAAU,CAAC,EAAE,CAAC,CACdI,oBAAoB,CAAC,EAAE,CAAC,CAC1B,CAAE,CACFoC,KAAK,CAAE,CAAEiB,UAAU,CAAE,KAAM,CAAE,CAC7BP,QAAQ,CAAE3C,SAAU,CAAA+B,QAAA,CACrB,eAED,CAAQ,CAAC,EACT,CACH,CACG,CAAC,cACPrD,IAAA,QAAKuD,KAAK,CAAE,CAAEC,SAAS,CAAE,MAAO,CAAE,CAAAH,QAAA,cAChCnD,KAAA,MAAAmD,QAAA,EAAG,yBAAuB,cAAArD,IAAA,WAAQsD,SAAS,CAAC,UAAU,CAACiB,OAAO,CAAE/D,oBAAqB,CAAA6C,QAAA,CAAC,UAAQ,CAAQ,CAAC,EAAG,CAAC,CACxG,CAAC,EACH,CAAC,CACH,CAAC,CACI,CAAC,CAEjB,CAEA,cAAe,CAAAhD,KAAK","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}